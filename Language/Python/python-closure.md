# 파이썬 클로저 (Python Closure)

## 클로저(Closure)란?
클로저(Closure)는 **외부 함수에서 정의된 변수를 기억하고 접근할 수 있는 내부 함수**를 말합니다.
즉, 외부 함수가 실행을 마치고 반환된 후에도, 내부 함수가 외부 함수의 변수(프리 변수, Free Variable)를 참조하고 있다면 그 변수의 상태가 유지됩니다.

핵심은 **자신이 생성될 때의 환경(Scope)을 기억한다는 점**입니다.

## 왜 사용할까?
클로저를 사용하는 주된 이유는 다음과 같습니다.

1.  **데이터 은닉 (Data Hiding):** 전역 변수를 사용하지 않고도 상태(변수)를 유지하고 숨길 수 있습니다. (객체 지향의 `private` 변수와 유사한 효과)
2.  **기능 확장 및 재사용:** 파이썬의 **데코레이터(Decorator)** 가 클로저를 기반으로 동작합니다.
3.  **지연 실행:** 설정(환경)을 먼저 해두고, 나중에 실제 연산을 수행할 수 있습니다.

## 예제 코드

```python
def mul(m):
    # wrapper 함수는 외부 함수의 변수 m을 참조(캡처)합니다.
    def wrapper(n):
        return m * n  # Python에서는 세미콜론(;)을 쓰지 않습니다.
    return wrapper

if __name__ == "__main__":
    # mul(3) 호출이 끝나도, 반환된 mul3(클로저)는 m=3 상태를 기억합니다.
    mul3 = mul(3)
    mul4 = mul(4)

    print(mul3(10)) # 30 출력 (3 * 10)
    print(mul4(10)) # 40 출력 (4 * 10)
```

## 동작 원리: 변수는 어떻게 살아남을까?
일반적으로 함수가 종료되면 그 안의 지역 변수는 메모리에서 사라져야 합니다. 하지만 클로저는 어떻게 변수를 계속 기억하는 걸까요?

### 1. 스택(Stack) vs 힙(Heap)
*   **일반 함수:** 함수가 실행되면 **스택(Stack)** 에 변수가 생성되고, 함수가 끝나면 스택 프레임이 제거되면서 변수도 함께 소멸합니다.
*   **클로저:** 파이썬은 내부 함수가 외부 함수의 변수(프리 변수)를 참조하고 있음을 감지하면, 이 변수를 스택이 아닌 **별도의 공간(Heap 영역의 Cell Object)** 에 저장해둡니다.

### 2. `__closure__` 속성 확인
실제로 파이썬은 반환되는 내부 함수(클로저)에 이 별도 공간을 연결(`__closure__`)하여 내보냅니다. 마치 **"함수가 짐(변수)을 싸서 배낭에 넣은 채로 세상에 나오는 것"** 과 같습니다.

코드로 직접 확인해볼 수 있습니다.

```python
mul3 = mul(3)

# mul 함수는 이미 종료되었지만, mul3 내부에는 3이 살아있습니다.
# __closure__ 속성을 통해 감춰진 변수(Cell Object)를 확인할 수 있습니다.
print(mul3.__closure__[0].cell_contents) 
# 출력: 3
```

## 정리
위 예제에서 `mul` 함수는 `wrapper` 함수를 반환합니다. 이때 `wrapper`는 자신의 외부 스코프에 있는 변수 `m`을 캡처하여 저장합니다.

